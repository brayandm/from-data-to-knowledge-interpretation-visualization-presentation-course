---
title: "Homework 3"
author: "Brayan Duran Medina"
output: html_document
---

IN THE FOLDER OF MATERIALS OF TODAY'S SESSION YOU WILL FIND A CSV CALLED FERTILITY
This dataset comes from Our World in Data, https://ourworldindata.org/ 

PLEASE PERFORM THE FOLLWING TASKS:

READ THE CSV INTO R. NAME THE OBJECT AS ass3.#####

```{r}
ass3 <- read.csv("fertility.csv")
```

## EX1: #######
Create a line plot showing the evolution of the fertility rate (FR) in Italy between 
1950 and 2021. Please, annotate the maximum and minimum value within your plot.
Save your plot as png file.

```{r}
library(ggplot2)

italy_data <- subset(ass3, Entity == "Italy" & Year >= 1950 & Year <= 2021)

max_fr <- max(italy_data$FR)
min_fr <- min(italy_data$FR)
max_year <- italy_data$Year[which.max(italy_data$FR)]
min_year <- italy_data$Year[which.min(italy_data$FR)]

p1 <- ggplot(italy_data, aes(x = Year, y = FR)) +
  geom_line() +
  geom_point(aes(x = max_year, y = max_fr), color = "red") +
  geom_point(aes(x = min_year, y = min_fr), color = "blue") +
  annotate("text", x = max_year, y = max_fr, label = round(max_fr, 2), vjust = -1) +
  annotate("text", x = min_year, y = min_fr, label = round(min_fr, 2), vjust = -1) +
  ylim(min_fr - 0.1, max_fr + 0.1) +
  ggtitle("Fertility Rate in Italy (1950-2021)") +
  xlab("Year") +
  ylab("Fertility Rate")

ggsave("plot1.png", plot = p1)

print(p1)
```

## EX2: ####### 
Create a multi-line plot showing the evolution of the FR for  Italy, 
Spain and Greece between 1950 and 2021. Please, place the legend on the top-
right corner inside the plot area. 
Save your plot as png file.

```{r}
countries_data <- subset(ass3, Entity %in% c("Italy", "Spain", "Greece") & Year >= 1950 & Year <= 2021)

p2 <- ggplot(countries_data, aes(x = Year, y = FR, color = Entity)) +
  geom_line() +
  theme(legend.position = c(0.9, 0.8)) +
  labs(color = "Country") +
  ggtitle("Fertility Rate in Italy, Spain, and Greece (1950-2021)") +
  xlab("Year") +
  ylab("Fertility Rate")

ggsave("plot2.png", plot = p2)

print(p2)
```

## EX3: #######
Create a boxplot with the FR by continents (C3) for the year 2020. Please 
order the boxplots according to the median fertility in each continent. Hint:
fct_reorder(.fun='median')
Save your plot as png file. 

```{r}
library(dplyr)
library(forcats)

data_2020 <- subset(ass3, Year == 2020)

p3 <- ggplot(data_2020, aes(x = fct_reorder(C3, FR, .fun = median), y = FR)) +
  geom_boxplot() +
  ggtitle("Fertility Rate by Continents (2020)") +
  xlab("Continent") +
  ylab("Fertility Rate")

ggsave("plot3.png", plot = p3)

print(p3)
```

## EX4: #####
Create a bar plot with those countries that have a FR>= 4.5 in 2021. Fill
the bars (colors) using variable C4, order the bars in descendent order and 
add labels to each bar with the value of the FR (2 decimals, please).Hint: 
round(x,2)
Save your plot as png file.

```{r}
data_2021_high_fr <- subset(ass3, Year == 2021 & FR >= 4.5)

p4 <- ggplot(data_2021_high_fr, aes(x = reorder(Entity, -FR), y = FR, fill = C4)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(FR, 2)), vjust = -0.3) +
  ggtitle("Countries with Fertility Rate >= 4.5 in 2021") +
  xlab("Country") +
  ylab("Fertility Rate") +
  ylim(0, 8) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

ggsave("plot4.png", plot = p4)

print(p4)
```

## EX5: ######
Create a facet boxplot using data of all countries for years that end in 0 or 5.
Place year on the x-axis (hint x=factor(YEAR)) and the fertility rates on the y-axis
Use variable C3 (continent) for producing a faceted boxplot. 
Please, don't use the default colors  from ggplot. 
Save your plot as png file. 

```{r}
years_ending_in_0_or_5 <- subset(ass3, Year %% 5 == 0)

p5 <- ggplot(years_ending_in_0_or_5, aes(x = factor(Year), y = FR, fill = C3)) +
  geom_boxplot() +
  facet_wrap(~ C3) +
  ggtitle("Fertility Rates for Years Ending in 0 or 5") +
  xlab("Year") +
  ylab("Fertility Rate") +
  theme(
    axis.text.x = element_text(angle = 45, vjust = 0.5, size = 6),
  ) +
  scale_fill_manual(values = c("red", "green", "blue", "purple", "orange", "yellow"))

ggsave("plot5.png", plot = p5, width = 12, height = 6)

print(p5)
```

## EX6: ######
Create a grouped bar plot with the fertility values in 1980,2000 and 2020 for
Argentina, Brazil and Chile. (Hint: fill=factor(Year))
Please set a label with the value of FR inside each bar 
(Hint: https://r-graphics.org/recipe-bar-graph-labels) 

```{r}
selected_years <- subset(ass3, Entity %in% c("Argentina", "Brazil", "Chile") & Year %in% c(1980, 2000, 2020))

p6 <- ggplot(selected_years, aes(x = Entity, y = FR, fill = factor(Year))) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = round(FR, 2)), position = position_dodge(width = 0.9), vjust = 1.5) +
  ggtitle("Fertility Rates for Argentina, Brazil, and Chile (1980, 2000, 2020)") +
  xlab("Country") +
  ylab("Fertility Rate") +
  labs(fill = "Year")

ggsave("plot6.png", plot = p6)

print(p6)
```

## EX7: #####
Challenge: Create the ugliest theme you can and use it over any of previous plots. 

```{r}
ugly_theme <- theme(
  panel.background = element_rect(fill = "yellow"),
  plot.background = element_rect(fill = "pink"),
  legend.background = element_rect(fill = "green"),
  panel.grid.major = element_line(color = "red"),
  panel.grid.minor = element_line(color = "blue"),
  axis.text = element_text(color = "brown"),
  axis.title = element_text(color = "purple"),
  plot.title = element_text(color = "orange", size = 20)
)

p7 <- p1 + ugly_theme

ggsave("plot7.png", plot = p7)

print(p7)
```